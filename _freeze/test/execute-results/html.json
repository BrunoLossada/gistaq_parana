{
  "hash": "a6a3628ba7189da777317b99ab3b03de",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Proyecto Paraná 2023\"\nformat: \n  html:\n    anchor-sections: true\n    number-sections: true\n    embed-resources: true\n    include-in-header: extras/favicon.html\n    theme:\n      - extras/mis_estilos.scss\n    toc: true\n    toc-float: false\n    toc-location: left\n    toc-title: \"Contenido\"\n    mainfont: Ubuntu\n    link-external-icon: false\n    link-external-newwindow: true\n    link-citations: true\n    code-link: true\n    code-copy: true\n    code-annotations: false\n    code-line-numbers: false\n    tbl-cap-location: margin\n    fig-cap-location: bottom\n    bibliography: biblio/bibliografia.bib\n    csl: biblio/ieee.csl\n    html-math-method: katex\n    callout-icon: false\neditor_options:\n  chunk_output_type: console\ncrossrefs-hover: false\nlang: es\nexecute: \n  echo: false\n  warning: false\n  eval: true\n---\n\n::: {.cell}\n\n:::\n\n\n\n# Muestreos {#sec-muestreos}\n\nLos muestreos, según lo permita la logística, se llevan a cabo cada fecha de adquisición de S2-MSI, cada 5 días sobre la región de interés, con cielo despejado. El plan de adquisición actualizado puede [descargarse](https://sentinels.copernicus.eu/web/sentinel/copernicus/sentinel-2/acquisition-plans) en formato `.kml`. Hola @Luo2020.\n\nEn cada fecha se toman 8 muestras de agua sobre una transecta a lo largo del río Paraná. Los sitios son aproximadamente equidistantes entre sí y con las orillas. Hola @Allam2020.\n\n\n\nEl proyecto está gestionado mediante el paquete [`targets`](https://books.ropensci.org/targets/). Para ejecutar todas las funciones, correr en la consola:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntargets::tar_make()\n```\n:::\n\n\n\nEsto genera una ejecución en cadena de múltiples funciones que permiten la obtención de datos espectrales y fisicoquímicos para la generación y almacenamiento de resultados.\n\nUtilizar `targets` permite asegurar el orden correcto de ejecución y facilita la resolución de potenciales problemas.\n\n## Funciones\n\nEl archivo `_targets.R` contiene los paquetes necesarios y las funciones a ejecutar, en el orden adecuado y las relaciones entre sí.\n\nPara visualizar las dependencias y el estado actual entre funciones correr:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntargets::tar_visnetwork()\n```\n:::\n\n\n\n::: {.column-page}\n\n:::\n\n:::: {.callout-note title=\"Ejecución\" collapse=true}\n\n\n\n\n::: {.cell}\n::: {#fig-visnetwork .cell-output-display}\n\n```{=html}\n<div class=\"visNetwork html-widget html-fill-item\" id=\"htmlwidget-ba33661a12410639cf0d\" style=\"width:100%;height:464px;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-ba33661a12410639cf0d\">{\"x\":{\"nodes\":{\"name\":[\"datos_gis\",\"datos_lab\",\"excel\",\"fecha_descarga\",\"producto_zip\",\"recorte_tif\",\"script_py\",\"mensaje\",\"fecha\",\"publico_quarto\",\"descarga\",\"archivo_excel\",\"recorte\",\"elimino\",\"script_descarga_py\",\"reflectancia\",\"lab\",\"estado_descarga\"],\"type\":[\"stem\",\"stem\",\"stem\",\"stem\",\"stem\",\"stem\",\"stem\",\"function\",\"function\",\"function\",\"function\",\"function\",\"function\",\"function\",\"function\",\"function\",\"function\",\"function\"],\"description\":[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],\"status\":[\"outdated\",\"uptodate\",\"uptodate\",\"uptodate\",\"outdated\",\"outdated\",\"errored\",\"uptodate\",\"uptodate\",\"uptodate\",\"uptodate\",\"uptodate\",\"uptodate\",\"uptodate\",\"uptodate\",\"uptodate\",\"uptodate\",\"uptodate\"],\"seconds\":[0.8,0.39,3.05,0.16,0.06,0.11,0.02,null,null,null,null,null,null,null,null,null,null,null],\"bytes\":[50216,8353,259621,73,67,1116130,106,null,null,null,null,null,null,null,null,null,null,null],\"branches\":[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],\"label\":[\"datos_gis\",\"datos_lab\",\"excel\",\"fecha_descarga\",\"producto_zip\",\"recorte_tif\",\"script_py\",\"mensaje\",\"fecha\",\"publico_quarto\",\"descarga\",\"archivo_excel\",\"recorte\",\"elimino\",\"script_descarga_py\",\"reflectancia\",\"lab\",\"estado_descarga\"],\"color\":[\"#78B7C5\",\"#354823\",\"#354823\",\"#354823\",\"#78B7C5\",\"#78B7C5\",\"#C93312\",\"#354823\",\"#354823\",\"#354823\",\"#354823\",\"#354823\",\"#354823\",\"#354823\",\"#354823\",\"#354823\",\"#354823\",\"#354823\"],\"id\":[\"datos_gis\",\"datos_lab\",\"excel\",\"fecha_descarga\",\"producto_zip\",\"recorte_tif\",\"script_py\",\"mensaje\",\"fecha\",\"publico_quarto\",\"descarga\",\"archivo_excel\",\"recorte\",\"elimino\",\"script_descarga_py\",\"reflectancia\",\"lab\",\"estado_descarga\"],\"level\":[7,3,2,3,5,6,4,1,1,0,1,1,2,2,2,2,2,3],\"shape\":[\"dot\",\"dot\",\"dot\",\"dot\",\"dot\",\"dot\",\"dot\",\"triangle\",\"triangle\",\"triangle\",\"triangle\",\"triangle\",\"triangle\",\"triangle\",\"triangle\",\"triangle\",\"triangle\",\"triangle\"]},\"edges\":{\"from\":[\"mensaje\",\"mensaje\",\"mensaje\",\"mensaje\",\"mensaje\",\"fecha\",\"fecha\",\"script_descarga_py\",\"excel\",\"lab\",\"descarga\",\"script_py\",\"fecha_descarga\",\"producto_zip\",\"recorte\",\"archivo_excel\",\"excel\",\"fecha\",\"fecha_descarga\",\"script_descarga_py\",\"excel\",\"fecha_descarga\",\"recorte_tif\",\"reflectancia\"],\"to\":[\"recorte\",\"elimino\",\"reflectancia\",\"script_descarga_py\",\"estado_descarga\",\"reflectancia\",\"lab\",\"estado_descarga\",\"datos_lab\",\"datos_lab\",\"producto_zip\",\"producto_zip\",\"recorte_tif\",\"recorte_tif\",\"recorte_tif\",\"excel\",\"fecha_descarga\",\"fecha_descarga\",\"script_py\",\"script_py\",\"datos_gis\",\"datos_gis\",\"datos_gis\",\"datos_gis\"],\"arrows\":[\"to\",\"to\",\"to\",\"to\",\"to\",\"to\",\"to\",\"to\",\"to\",\"to\",\"to\",\"to\",\"to\",\"to\",\"to\",\"to\",\"to\",\"to\",\"to\",\"to\",\"to\",\"to\",\"to\",\"to\"]},\"nodesToDataframe\":true,\"edgesToDataframe\":true,\"options\":{\"width\":\"100%\",\"height\":\"100%\",\"nodes\":{\"shape\":\"dot\",\"physics\":false},\"manipulation\":{\"enabled\":false},\"edges\":{\"smooth\":{\"type\":\"cubicBezier\",\"forceDirection\":\"horizontal\"}},\"physics\":{\"stabilization\":false},\"interaction\":{\"zoomSpeed\":1},\"layout\":{\"hierarchical\":{\"enabled\":true,\"direction\":\"LR\"}}},\"groups\":null,\"width\":null,\"height\":null,\"idselection\":{\"enabled\":false,\"style\":\"width: 150px; height: 26px\",\"useLabels\":true,\"main\":\"Select by id\"},\"byselection\":{\"enabled\":false,\"style\":\"width: 150px; height: 26px\",\"multiple\":false,\"hideColor\":\"rgba(200,200,200,0.5)\",\"highlight\":false},\"main\":{\"text\":\"\",\"style\":\"font-family:Georgia, Times New Roman, Times, serif;font-weight:bold;font-size:20px;text-align:center;\"},\"submain\":null,\"footer\":null,\"background\":\"rgba(0, 0, 0, 0)\",\"highlight\":{\"enabled\":true,\"hoverNearest\":false,\"degree\":{\"from\":1,\"to\":1},\"algorithm\":\"hierarchical\",\"hideColor\":\"rgba(200,200,200,0.5)\",\"labelOnly\":true},\"collapse\":{\"enabled\":true,\"fit\":false,\"resetHighlight\":true,\"clusterOptions\":null,\"keepCoord\":true,\"labelSuffix\":\"(cluster)\"},\"legend\":{\"width\":0.2,\"useGroups\":false,\"position\":\"right\",\"ncol\":1,\"stepX\":100,\"stepY\":100,\"zoom\":true,\"nodes\":{\"label\":[\"Outdated\",\"Up to date\",\"Errored\",\"Stem\",\"Function\"],\"color\":[\"#78B7C5\",\"#354823\",\"#C93312\",\"#899DA4\",\"#899DA4\"],\"shape\":[\"dot\",\"dot\",\"dot\",\"dot\",\"triangle\"]},\"nodesToDataframe\":true},\"tooltipStay\":300,\"tooltipStyle\":\"position: fixed;visibility:hidden;padding: 5px;white-space: nowrap;font-family: verdana;font-size:14px;font-color:#000000;background-color: #f5f4ed;-moz-border-radius: 3px;-webkit-border-radius: 3px;border-radius: 3px;border: 1px solid #808074;box-shadow: 3px 3px 10px rgba(0, 0, 0, 0.2);\"},\"evals\":[],\"jsHooks\":[]}</script>\n```\n\n\nGrafo de dependencias.\n:::\n:::\n\n\n\nLa figura es interactiva y pueden seleccionarse los nodos para identificar las dependencias.\n\nA continuación, se describen las funciones objetivo, indicadas con triángulos (<span class='nf nf-md-triangle'></span>) en la figura anterior.\n\n### `excel` {#sec-excel}\n\nEl archivo Excel `datos/datos_gistaq.xlsx` contiene todos los datos del muestreo y los resultados de los análisis fisicoquímicos.\n\nIncluye la fecha, las coordenadas geográficas de los sitios de muestreo, los valores de pH, conductividad (μS/cm), profundidad de disco de Secchi (cm), sólidos suspendidos (mg/L) y turbidez, por dos métodos: colorimétrico (HATCH, NTU) y turbidímetro (Hazemeter, EBC).\n\nAl finalizar el procesamiento de cada nueva muestra de agua ([$\\S$-@sec-muestreos]), se actualiza manualmente con los datos obtenidos. La ejecución del comando mostrado al inicio de esta sección ([$\\S$-@sec-ejecucion]) genera la suceción de todas las funciones siguientes.\n\n### `fecha_descarga` {#sec-fecha-descarga}\n\nA partir de las fechas ya previamente analizadas, tomadas de la base de datos, se obtiene del archivo Excel, la última fecha faltante.\n\nA partir de esta fecha se procede a la descarga del producto correspondiente.\n\n### `script_py`\n\nUsando la plantilla `scripts/plantilla.py` de un código de programación en Python, se genera el archivo `scripts/d.py` que contiene los parámetros de búsqueda del producto de interés.\n\nSe establecen las coordenadas de la región de interés ($-58° 48' 48''S$, $+27° 29' 18''O$), la fecha ([$\\S$@sec-fecha-descarga]) y el nivel de procesamiento.\n\n### `producto_zip`\n\nSe ejecuta el script Python que descarga el producto. Utiliza las credenciales de mi cuenta en [Copernicus Data Space Ecosystem](https://dataspace.copernicus.eu/). El nivel de procesamiento es L2A, en reflectancia de superficie, con corrección atmosférica automática.\n\nEl producto a descargar corresponde al SAFE y se encuentra comprimido en un archivo `.zip`. El tamaño del producto es 1Gb aproximadamente.\n\n### `recorte_tif`\n\nExtracción del contenido del `.zip` y creación de un stack a partir de las bandas de interés.\n\nEl stack contiene las bandas espectrales: B01, B02, B03, B04, B05, B06, B07, B08, B8A, B11 y B12. Se recorta al polígono `vector/recorte_puente.gpkg` y luego se hace un remuestreo a 10 m. Las características de estas bandas se detallan en la @tbl-s2msi.\n\nSe almacena el recorte `.tif`, siendo el nombre del archivo la fecha de adquisición del producto.\n\n### `datos_gis` {#sec-datos-gis}\n\nA partir de la fecha ([$\\S$@sec-fecha-descarga]), se genera un vector con las coordenadas geográficas del Excel ([$\\S$@sec-excel]). Luego, se extraen los valores de píxeles por cada banda. Se actualiza el archivo `datos/base_de_datos_gis.csv` ([$\\S$@sec-base-de-datos]) con los nuevos datos espectrales.\n\nLas características de las bandas espectrales se muestran a continuación:\n\n### `datos_lab`\n\nLos datos fisicoquímicos del Excel se extraen a partir de la fecha y se combinan con los datos ya presentes en el archivo `datos/base_de_datos_lab.csv`.\n\n## Creación de objetivos\n\nPara generar nuevos objetivos, hay que editar el archivo `_targets.R` agregando un nuevo elemento a `list()`:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntargets::tar_target(\n  names = nombre_de_objetivo,\n  command = funcion()\n)\n```\n:::\n\n\n\nLa `funcion()` se desarrolla en el archivo `scripts/funciones.R`. En caso de hacer el seguimiento de archivos agregar el argumento `format = \"file\"`.\n\nLos objetivos se muestran como círculos (<span class='nf nf-fa-circle'></span>) en el [grafo -@fig-visnetwork] de dependencias.\n\n## Datos\n\nLos datos generados son del tipo archivo de texto (`.csv`) y ráster (`.tif`).\n\n### Bases de datos {#sec-base-de-datos}\n\nLa ejecución de `targets` tiene como propósito ([$\\S$@sec-objetivos]) la obtención de los datos espectrales y fisicoquímicos de los sitios de muestreo sobre el río Paraná.\n\n* Datos espectrales, `datos/base_de_datos_gis.csv`\n\nEl archivo de texto posee los valores de reflectancia de superficie (entre $0 - 1$) para cada banda de S2-MSI. Se generan dos valores para cada sitio: <b>1x1</b>, que consiste en el valor exacto del píxel; y <b>3x3</b>, que toma la media de una ventana de píxeles alrededor del píxel central.\n\nSe incluye la fecha, el número de sitio y las coordenadas geográficas en el sistema EPSG:4326, en latitud y longitud.\n\n* Datos fisicoquímicos, `datos/base_de_datos_lab.csv`\n\nSobre el curso de agua se obtienen pH, conductividad, profundidad de disco de Secchi y las coordenadas geográficas. En laboratorio se miden turbidez por dos métodos: colorimétrico (HACH) y turbidímetro (Hazemeter), y sólidos suspendidos por gravimetría.\n\n### Recortes ráster\n\nLos productos S2-MSI son recortados a la región de interés, alrededor del [Puente Chaco-Corrientes](https://www.openstreetmap.org/#map=15/-27.4687/-58.8608).\n\nSe genera un stack con las bandas de interés ([$\\S$@sec-datos-gis]) y se almacena con el nombre de la fecha correspondiente en la carpeta `recorte/` con formato `.tif`.\n\n## Entorno de ejecución\n\nDefinir las versiones de los paquetes utilizados en el presente proyecto es relevante ya que permite asegurar la reproducibilidad de los resultados. Para tal fin se emplea el paquete [`renv`](https://rstudio.github.io/renv/).\n\nLa instalación de paquetes se realiza de manera tradicional:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ninstall.packages(\"nombre_del_paquete\")\n```\n:::\n\n\n\nCada vez que se instale, actualice o remueva un nuevo paquete ejecutar en la consola:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrenv::snapshot()\n```\n:::\n\n\n\nEsto actualiza el archivo `renv.lock` con la información de cada paquete. Para verificar el estado actual de `renv`, correr:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrenv::status()\n```\n:::\n\n\n\n## Quarto\n\nEl presente sitio web fue desarrollado con la herramienta [Quarto](https://quarto.org/). Para generar el sitio web se debe renderizar el archivo `index.qmd` que produce `index.html`.\n\nLa publicación se lleva a cabo en [Quarto Pub](https://quartopub.com/). Los datos de publicación se registran en el archivo `_publish.yml`.\n\nPara regenerar el `.html` e inmediatamente publicar el sitio web, correr en la terminal:\n\n```{.bash}\nquarto publish index.qmd\n```\n\nEn la terminal se debe elegir la cuenta asociada a Quarto Pub.\n\n::::\n\n# Algoritmos {#sec-algoritmos}\n\nEl desarrollo de los algoritmos para la estimación de indicadores de calidad del agua requiere la combinación de datos espectrales y fisicoquímicos.\n\nSe proponen múltiples mode los para la estimación de parámetros. Se siguen los lineamientos de [`tidymodels`](https://www.tmwr.org/) para el entrenamiento y validación de los mode los.",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"test_files/libs/htmltools-fill-0.5.8.1/fill.css\" rel=\"stylesheet\" />\n<script src=\"test_files/libs/htmlwidgets-1.6.4/htmlwidgets.js\"></script>\n<link href=\"test_files/libs/vis-9.1.0/vis-network.min.css\" rel=\"stylesheet\" />\n<script src=\"test_files/libs/vis-9.1.0/vis-network.min.js\"></script>\n<script src=\"test_files/libs/visNetwork-binding-2.1.2/visNetwork.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}